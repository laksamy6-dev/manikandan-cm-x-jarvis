<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CM-X GENESIS: The Digital Twin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: "Neural Clarity" - A professional light theme with distinct functional colors. Background: Soft Gray-Blue (slate-50). Cards: White. Accents: Indigo (AI/Logic), Emerald (Buy/Profit), Rose (Sell/Loss), Amber (Warning/Learning). This ensures high readability and a clean, 'medical/scientific' dashboard aesthetic suitable for monitoring a 'Brain'. -->

    <!-- Application Structure Plan: 
         The app is designed as a "Neural Command Center" to visualize the 'CM-X GENESIS' Python logic.
         1. Header: System Status, Identity (Boss & Chellakili), and Global Controls (Start/Stop/Reset).
         2. The Cortex (Top Section): A split view. Left: 'Ensemble Intelligence' (Radar Chart) showing the voting weights of the 5 agents. Right: 'Physics Engine' (Velocity/Acceleration Gauges) visualizing the Newtonian market analysis.
         3. Live Market Simulation (Middle Section): A dynamic Line Chart representing Nifty 50 price action, overlaid with Buy/Sell signals generated by the JS 'Brain'. 
         4. The Synapse (Bottom Left): A 'Mentor Chat' interface where the AI explains its decisions ('Teacher Mode') using the persona from the documents.
         5. Memory & Evolution (Bottom Right): A log of 'Lessons Learned' and controls to manually 'Train' (adjust weights) the agents, mimicking the self-correcting logic.
         
         Reasoning: This structure demystifies the 'Black Box' nature of the AI. By separating the 'Inputs' (Physics/Agents), 'Process' (Simulation), and 'Output' (Chat/Logs), the user can intuitively understand how the bot 'thinks' and 'learns' as described in the source code.
    -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            height: 300px;
            max-height: 400px; 
        }

        .radar-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 300px;
            margin: 0 auto;
        }

        /* Custom Scrollbar for Logs */
        .scroller::-webkit-scrollbar { width: 6px; }
        .scroller::-webkit-scrollbar-track { background: #f1f5f9; }
        .scroller::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .scroller::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white text-xl font-bold shadow-lg shadow-indigo-200">
                    üß†
                </div>
                <div>
                    <h1 class="text-xl font-bold text-slate-900 tracking-tight">CM-X GENESIS <span class="text-indigo-600">V3</span></h1>
                    <p class="text-xs text-slate-500 font-medium">The Digital Twin & Artificial Brain</p>
                </div>
            </div>
            
            <div class="flex items-center gap-6 text-sm">
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                    <span class="font-semibold text-slate-600">System: <span class="text-emerald-600">ONLINE</span></span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-slate-400">Owner:</span>
                    <span class="font-bold text-slate-800">Boss Manikandan</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-slate-400">Co-Pilot:</span>
                    <span class="font-bold text-indigo-600">Chellakili AI</span>
                </div>
            </div>

            <div class="flex gap-2">
                <button id="btn-start" class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-md text-sm font-semibold shadow-sm transition-colors flex items-center gap-2">
                    <span>‚ñ∂</span> Start Simulation
                </button>
                <button id="btn-stop" class="hidden px-4 py-2 bg-rose-600 hover:bg-rose-700 text-white rounded-md text-sm font-semibold shadow-sm transition-colors flex items-center gap-2">
                    <span>‚èπ</span> Stop
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8 space-y-8">

        <!-- Introduction Section -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <h2 class="text-lg font-bold text-slate-800 mb-2">Neural Architecture Overview</h2>
            <p class="text-slate-600 text-sm leading-relaxed max-w-4xl">
                This interface visualizes the internal logic of the <strong>CM-X GENESIS</strong> trading bot. Unlike traditional algorithms, GENESIS operates as a "Collective Brain" where five distinct AI agents vote on every decision. It utilizes a custom <strong>Physics Engine</strong> to calculate Market Velocity ($v$) and Acceleration ($a$) to predict reversals, mimicking Newton's laws applied to the Nifty 50 index. Watch as the brain learns, adapts weights based on success, and explains its logic in real-time.
            </p>
        </section>

        <!-- Top Row: The Brain (Agents & Physics) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- Ensemble Intelligence (Radar Chart) -->
            <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6 flex flex-col">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="text-base font-bold text-slate-800 flex items-center gap-2">
                            <span class="text-indigo-500">‚ùñ</span> Ensemble Council
                        </h3>
                        <p class="text-xs text-slate-500 mt-1">Real-time voting weights of the 5 internal agents.</p>
                    </div>
                    <span class="px-2 py-1 bg-indigo-50 text-indigo-700 text-xs rounded font-mono font-bold" id="total-xp">XP: 0</span>
                </div>
                
                <div class="flex-grow flex items-center justify-center">
                    <div class="radar-container">
                        <canvas id="agentRadarChart"></canvas>
                    </div>
                </div>

                <div class="mt-4 grid grid-cols-2 gap-2 text-xs">
                    <div class="p-2 bg-slate-50 rounded border border-slate-100">
                        <span class="font-bold text-indigo-600">Physics Agent:</span> Momentum & Velocity focus.
                    </div>
                    <div class="p-2 bg-slate-50 rounded border border-slate-100">
                        <span class="font-bold text-emerald-600">Trend Agent:</span> SuperTrend follower.
                    </div>
                    <div class="p-2 bg-slate-50 rounded border border-slate-100">
                        <span class="font-bold text-amber-600">Option Chain:</span> OI & Max Pain logic.
                    </div>
                    <div class="p-2 bg-slate-50 rounded border border-slate-100">
                        <span class="font-bold text-rose-600">Volatility:</span> VIX & fear gauge.
                    </div>
                </div>
            </div>

            <!-- Physics Engine (Kinematics) -->
            <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6 flex flex-col">
                <div class="mb-4">
                    <h3 class="text-base font-bold text-slate-800 flex items-center gap-2">
                        <span class="text-amber-500">‚ö°</span> Physics Engine
                    </h3>
                    <p class="text-xs text-slate-500 mt-1">Market Kinematics: $F = m \cdot a$ applied to Price.</p>
                </div>

                <div class="grid grid-cols-2 gap-6 flex-grow items-center">
                    <!-- Velocity Gauge Logic -->
                    <div class="text-center space-y-2">
                        <div class="text-xs font-semibold text-slate-400 uppercase tracking-wider">Velocity ($v$)</div>
                        <div id="velocity-value" class="text-4xl font-black mono text-slate-300">0.00</div>
                        <div class="h-2 w-full bg-slate-100 rounded-full overflow-hidden relative">
                            <div id="velocity-bar" class="absolute top-0 bottom-0 left-1/2 w-0 bg-slate-400 transition-all duration-300"></div>
                        </div>
                        <div class="text-xs text-slate-400">Direction & Speed</div>
                    </div>

                    <!-- Acceleration Gauge Logic -->
                    <div class="text-center space-y-2">
                        <div class="text-xs font-semibold text-slate-400 uppercase tracking-wider">Acceleration ($a$)</div>
                        <div id="acceleration-value" class="text-4xl font-black mono text-slate-300">0.00</div>
                        <div class="h-2 w-full bg-slate-100 rounded-full overflow-hidden relative">
                            <div id="acceleration-bar" class="absolute top-0 bottom-0 left-1/2 w-0 bg-slate-400 transition-all duration-300"></div>
                        </div>
                        <div class="text-xs text-slate-400">Rate of Change</div>
                    </div>
                </div>

                <div class="mt-6 p-3 bg-amber-50 border border-amber-100 rounded-lg">
                    <h4 class="text-xs font-bold text-amber-800 mb-1">Physics Insight:</h4>
                    <p id="physics-insight" class="text-xs text-amber-700 italic">Waiting for market data...</p>
                </div>
            </div>
        </div>

        <!-- Middle Row: Live Market Feed -->
        <section class="bg-white rounded-xl shadow-lg border border-slate-200 p-6">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h3 class="text-base font-bold text-slate-800">Live Market Simulation (Nifty 50)</h3>
                    <p class="text-xs text-slate-500">Visualizing 1-Second Ticks. Green Dots = Buy Signals, Red Dots = Sell Signals.</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold mono text-slate-800" id="current-price">19,500.00</div>
                    <div class="text-xs font-bold text-emerald-500" id="price-change">+0.00 (0.00%)</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="marketChart"></canvas>
            </div>
        </section>

        <!-- Bottom Row: Mentor & Memory -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Mentor Chat (Teacher Mode) -->
            <div class="lg:col-span-2 bg-white rounded-xl shadow-lg border border-slate-200 p-6 flex flex-col h-96">
                <div class="mb-4 flex items-center justify-between">
                    <h3 class="text-base font-bold text-slate-800 flex items-center gap-2">
                        <span class="text-emerald-500">üí¨</span> Chellakili's Mentor Mode
                    </h3>
                    <span class="text-xs px-2 py-0.5 bg-slate-100 rounded-full text-slate-500">Live Feed</span>
                </div>
                
                <div id="chat-log" class="flex-grow overflow-y-auto scroller space-y-3 pr-2 bg-slate-50 rounded-lg p-4 border border-slate-100">
                    <!-- Dynamic Messages will appear here -->
                    <div class="flex gap-3">
                        <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 text-xs font-bold flex-shrink-0">AI</div>
                        <div class="bg-white p-3 rounded-lg rounded-tl-none border border-slate-200 shadow-sm text-sm text-slate-600">
                            Vanakkam Boss! I am initialized and ready. The <strong>Physics Engine</strong> is warming up. Click "Start Simulation" to begin training.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Memory & Manual Training -->
            <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6 flex flex-col h-96">
                <div class="mb-4">
                    <h3 class="text-base font-bold text-slate-800 flex items-center gap-2">
                        <span class="text-rose-500">‚öôÔ∏è</span> Brain Training
                    </h3>
                    <p class="text-xs text-slate-500">Manual Override & Memory Logs</p>
                </div>

                <div class="flex-grow overflow-y-auto scroller mb-4 space-y-2" id="memory-log">
                    <!-- Memory Logs -->
                    <div class="text-xs text-slate-400 italic text-center p-4">No lessons learned yet.</div>
                </div>

                <div class="pt-4 border-t border-slate-100">
                    <label class="text-xs font-bold text-slate-700 block mb-2">Teacher Override (Manual Weight Adj.)</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="brain.trainAgent('PHYSICS_AGENT', 0.1)" class="px-3 py-2 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 text-xs font-bold rounded border border-indigo-200 transition-colors">
                            Boost Physics +
                        </button>
                        <button onclick="brain.trainAgent('TREND_AGENT', 0.1)" class="px-3 py-2 bg-emerald-50 hover:bg-emerald-100 text-emerald-700 text-xs font-bold rounded border border-emerald-200 transition-colors">
                            Boost Trend +
                        </button>
                        <button onclick="brain.trainAgent('OPTION_CHAIN_AGENT', 0.1)" class="px-3 py-2 bg-amber-50 hover:bg-amber-100 text-amber-700 text-xs font-bold rounded border border-amber-200 transition-colors">
                            Boost OI Data +
                        </button>
                        <button onclick="brain.trainAgent('PHYSICS_AGENT', -0.1)" class="px-3 py-2 bg-rose-50 hover:bg-rose-100 text-rose-700 text-xs font-bold rounded border border-rose-200 transition-colors">
                            Punish Physics -
                        </button>
                    </div>
                </div>
            </div>

        </div>

    </main>

    <!-- Visualization & Content Choices: 
         - Radar Chart: Chosen to visualize the 'Ensemble' nature. It clearly shows which agent dominates decision-making at any moment.
         - Line Chart: Standard for price action, but enhanced with 'Signal Bubbles' to show exactly WHERE the bot made a decision.
         - Gauges (Custom CSS Bars): Velocity/Acceleration are abstract physics concepts. Representing them as diverging bars (Left=Negative, Right=Positive) makes the 'Force' concept intuitive.
         - Chat Interface: Mimics the 'Telegram' feature mentioned in the source, reinforcing the 'Assistant/Co-Pilot' persona.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. Charts via Chart.js Canvas. -->

    <script>
        // --- 1. THE DIGITAL BRAIN LOGIC ---
        // Mimicking the Python Class Structure provided in the prompt

        const AGENT_CONFIG = {
            PHYSICS_AGENT: { color: 'rgba(79, 70, 229, 0.7)', label: 'Physics Engine' },
            TREND_AGENT: { color: 'rgba(16, 185, 129, 0.7)', label: 'Trend Follower' },
            OPTION_CHAIN_AGENT: { color: 'rgba(245, 158, 11, 0.7)', label: 'Option Chain' },
            VOLATILITY_AGENT: { color: 'rgba(225, 29, 72, 0.7)', label: 'Volatility' },
            PATTERN_AGENT: { color: 'rgba(100, 116, 139, 0.7)', label: 'Pattern Recog.' }
        };

        class DigitalBrain {
            constructor() {
                this.weights = {
                    PHYSICS_AGENT: 1.5,
                    TREND_AGENT: 1.0,
                    OPTION_CHAIN_AGENT: 1.2,
                    VOLATILITY_AGENT: 1.0,
                    PATTERN_AGENT: 0.8
                };
                this.xp = 0;
                this.history = []; // Price history for physics
                this.lessons = [];
                this.isLive = false;
                this.currentPrice = 19500;
                this.velocity = 0;
                this.acceleration = 0;
            }

            // The Physics Engine Logic (Ported from Python)
            calculatePhysics(price) {
                this.history.push(price);
                if (this.history.length > 50) this.history.shift();
                
                if (this.history.length < 5) return { v: 0, a: 0 };

                // Simple discrete derivative
                const v = price - this.history[this.history.length - 2];
                const prevV = this.history[this.history.length - 2] - this.history[this.history.length - 3] || 0;
                const a = v - prevV;

                this.velocity = v;
                this.acceleration = a;
                return { v, a };
            }

            // The Council Vote
            consultCouncil() {
                let votes = { BUY: 0, SELL: 0, WAIT: 0 };
                let details = [];

                // 1. Physics Agent Vote
                let pVote = "WAIT";
                if (this.velocity > 2 && this.acceleration > 0) pVote = "BUY";
                else if (this.velocity < -2 && this.acceleration < 0) pVote = "SELL";
                else if (this.velocity > 0 && this.acceleration < -1) pVote = "SELL (Divergence)"; // Momentum loss
                
                votes[pVote.split(" ")[0]] += this.weights.PHYSICS_AGENT;
                if(pVote !== "WAIT") details.push(`Physics says ${pVote} (v=${this.velocity.toFixed(1)})`);

                // 2. Trend Agent (Simulated Random Trend for Demo)
                // In real app, this checks SuperTrend
                const trend = Math.random() > 0.5 ? "BUY" : "SELL"; 
                votes[trend] += this.weights.TREND_AGENT;

                // 3. Option Chain (Simulated)
                const oi = Math.random() > 0.6 ? "BUY" : "WAIT";
                votes[oi] += this.weights.OPTION_CHAIN_AGENT;

                // Decision
                let decision = "WAIT";
                let maxScore = 0;
                for (const [key, val] of Object.entries(votes)) {
                    if (val > maxScore && val > 2.5) { // Threshold
                        maxScore = val;
                        decision = key;
                    }
                }

                return { decision, votes, details };
            }

            // Self-Learning / Manual Training
            trainAgent(agent, delta) {
                if (this.weights[agent]) {
                    this.weights[agent] = parseFloat((this.weights[agent] + delta).toFixed(2));
 
